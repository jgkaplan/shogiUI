!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Shogiground=e()}}((function(){return function e(t,o,n){function r(s,c){if(!o[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=o[s]={exports:{}};t[s][0].call(d.exports,(function(e){return r(t[s][1][e]||e)}),d,d.exports,e,t,o,n)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.render=o.anim=void 0;const n=e("./util");function r(e,t){const o=e(t);return t.dom.redraw(),o}function i(e,t){return{key:e,pos:n.key2pos(e),piece:t}}function s(e,t){return t.sort((t,o)=>n.distanceSq(e.pos,t.pos)-n.distanceSq(e.pos,o.pos))[0]}function c(e){for(const t in e)return!1;return!0}o.anim=function(e,t){return t.animation.enabled?function(e,t){const o=Object.assign({},t.pieces),r=e(t),a=function(e,t){const o={},r=[],c={},a=[],l=[],d={};let u,p,f;for(const n in e)d[n]=i(n,e[n]);for(const s of n.allKeys)u=t.pieces[s],p=d[s],u?p?n.samePiece(u,p.piece)||(a.push(p),l.push(i(s,u))):l.push(i(s,u)):p&&a.push(p);for(const i of l)p=s(i,a.filter(e=>n.samePiece(i.piece,e.piece))),p&&(f=[p.pos[0]-i.pos[0],p.pos[1]-i.pos[1]],o[i.key]=f.concat(f),r.push(p.key));for(const i of a)n.containsX(r,i.key)||(c[i.key]=i.piece);return{anims:o,fadings:c}}(o,t);if(c(a.anims)&&c(a.fadings))t.dom.redraw();else{const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:a},e||function e(t,o){const n=t.animation.current;if(void 0===n)return void(t.dom.destroyed||t.dom.redrawNow());const r=1-(o-n.start)*n.frequency;if(r<=0)t.animation.current=void 0,t.dom.redrawNow();else{const o=(i=r)<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1;for(const e in n.plan.anims){const t=n.plan.anims[e];t[2]=t[0]*o,t[3]=t[1]*o}t.dom.redrawNow(!0),requestAnimationFrame((o=performance.now())=>e(t,o))}var i}(t,performance.now())}return r}(e,t):r(e,t)},o.render=r},{"./util":18}],2:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.start=void 0;const n=e("./board"),r=e("./fen"),i=e("./config"),s=e("./anim"),c=e("./drag"),a=e("./explosion");o.start=function(e,t){function o(){n.toggleOrientation(e),t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&o(),(t.fen?s.anim:s.render)(e=>i.configure(e,t),e)},state:e,getFen:()=>r.write(e.pieces),toggleOrientation:o,setPieces(t){s.anim(e=>n.setPieces(e,t),e)},selectSquare(t,o){t?s.anim(e=>n.selectSquare(e,t,o),e):e.selected&&(n.unselect(e),e.dom.redraw())},move(t,o){s.anim(e=>n.baseMove(e,t,o),e)},newPiece(t,o){s.anim(e=>n.baseNewPiece(e,t,o),e)},playPremove(){if(e.premovable.current){if(s.anim(n.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=n.playPredrop(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){s.render(n.unsetPremove,e)},cancelPredrop(){s.render(n.unsetPredrop,e)},cancelMove(){s.render(e=>{n.cancelMove(e),c.cancel(e)},e)},stop(){s.render(e=>{n.stop(e),c.cancel(e)},e)},explode(t){a.default(e,t)},setAutoShapes(t){s.render(e=>e.drawable.autoShapes=t,e)},setShapes(t){s.render(e=>e.drawable.shapes=t,e)},getKeyAtDomPos:t=>n.getKeyAtDomPos(t,n.whitePov(e),e.dom.bounds()),redrawAll:t,dragNewPiece(t,o,n){c.dragNewPiece(e,t,o,n)},destroy(){n.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":1,"./board":3,"./config":4,"./drag":5,"./explosion":9,"./fen":10}],3:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.whitePov=o.getKeyAtDomPos=o.stop=o.cancelMove=o.playPredrop=o.playPremove=o.isDraggable=o.canMove=o.unselect=o.setSelected=o.selectSquare=o.dropNewPiece=o.userMove=o.baseNewPiece=o.baseMove=o.unsetPredrop=o.unsetPremove=o.setCheck=o.setPieces=o.reset=o.toggleOrientation=o.callUserFunction=void 0;const n=e("./util"),r=e("./premove");function i(e,...t){e&&setTimeout(()=>e(...t),1)}function s(e){e.premovable.current&&(e.premovable.current=void 0,i(e.premovable.events.unset))}function c(e){const t=e.predroppable;t.current&&(t.current=void 0,i(t.events.unset))}function a(e,t,o){const r=e.pieces[t],s=e.pieces[o];if(t===o||!r)return!1;const c=s&&s.color!==r.color?s:void 0;return o===e.selected&&f(e),i(e.events.move,t,o,c),function(e,t,o){if(!e.autoCastle)return!1;const r=e.pieces[t];if(!r||"king"!==r.role)return!1;const i=n.key2pos(t);if(5!==i[0])return!1;if(1!==i[1]&&8!==i[1])return!1;const s=n.key2pos(o);let c,a,l;if(7===s[0]||8===s[0])c=n.pos2key([8,i[1]]),a=n.pos2key([6,i[1]]),l=n.pos2key([7,i[1]]);else{if(3!==s[0]&&1!==s[0])return!1;c=n.pos2key([1,i[1]]),a=n.pos2key([4,i[1]]),l=n.pos2key([3,i[1]])}const d=e.pieces[c];return!(!d||"rook"!==d.role)&&(delete e.pieces[t],delete e.pieces[c],e.pieces[l]=r,e.pieces[a]=d,!0)}(e,t,o)||(e.pieces[o]=r,delete e.pieces[t]),e.lastMove=[t,o],e.check=void 0,i(e.events.change),c||!0}function l(e,t,o,r){if(e.pieces[o]){if(!r)return!1;delete e.pieces[o]}return i(e.events.dropNewPiece,t,o),e.pieces[o]=t,e.lastMove=[o],e.check=void 0,i(e.events.change),e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),!0}function d(e,t,o){const r=a(e,t,o);return r&&(e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),e.animation.current=void 0),r}function u(e,t,o){if(v(e,t,o)){const n=d(e,t,o);if(n){const r=e.hold.stop();f(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return!0!==n&&(s.captured=n),i(e.movable.events.after,t,o,s),!0}}else if(function(e,t,o){return t!==o&&h(e,t)&&n.containsX(r.default(e.pieces,t),o)}(e,t,o))return function(e,t,o,n){c(e),e.premovable.current=[t,o],i(e.premovable.events.set,t,o,n)}(e,t,o,{ctrlKey:e.stats.ctrlKey}),f(e),!0;return f(e),!1}function p(e,t){e.selected=t,h(e,t)?e.premovable.dests=r.default(e.pieces,t):e.premovable.dests=void 0}function f(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function g(e,t){const o=e.pieces[t];return!!o&&("both"===e.movable.color||e.movable.color===o.color&&e.turnColor===o.color)}function v(e,t,o){return t!==o&&g(e,t)&&(e.movable.free||!!e.movable.dests&&n.containsX(e.movable.dests[t],o))}function h(e,t){const o=e.pieces[t];return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function m(e){s(e),c(e),f(e)}o.callUserFunction=i,o.toggleOrientation=function(e){e.orientation=n.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},o.reset=function(e){e.lastMove=void 0,f(e),s(e),c(e)},o.setPieces=function(e,t){for(const o in t){const n=t[o];n?e.pieces[o]=n:delete e.pieces[o]}},o.setCheck=function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(const o in e.pieces)"king"===e.pieces[o].role&&e.pieces[o].color===t&&(e.check=o)},o.unsetPremove=s,o.unsetPredrop=c,o.baseMove=a,o.baseNewPiece=l,o.userMove=u,o.dropNewPiece=function(e,t,o,n){if(function(e,t,o){const n=e.pieces[t];return!!n&&o&&(t===o||!e.pieces[o])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}(e,t,o)||n){const r=e.pieces[t];delete e.pieces[t],l(e,r,o,n),i(e.movable.events.afterNewPiece,r.role,o,{predrop:!1})}else!function(e,t,o){const n=e.pieces[t],r=e.pieces[o];return!!n&&o&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==o[1]&&"9"!==o[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,o)?(s(e),c(e)):function(e,t,o){s(e),e.predroppable.current={role:t,key:o},i(e.predroppable.events.set,t,o)}(e,e.pieces[t].role,o);delete e.pieces[t],f(e)},o.selectSquare=function(e,t,o){if(i(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return f(e),void e.hold.cancel();if((e.selectable.enabled||o)&&e.selected!==t&&u(e,e.selected,t))return void(e.stats.dragged=!1)}(g(e,t)||h(e,t))&&(p(e,t),e.hold.start())},o.setSelected=p,o.unselect=f,o.canMove=v,o.isDraggable=function(e,t){const o=e.pieces[t];return!!o&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))},o.playPremove=function(e){const t=e.premovable.current;if(!t)return!1;const o=t[0],n=t[1];let r=!1;if(v(e,o,n)){const t=d(e,o,n);if(t){const s={premove:!0};!0!==t&&(s.captured=t),i(e.movable.events.after,o,n,s),r=!0}}return s(e),r},o.playPredrop=function(e,t){const o=e.predroppable.current;let n=!1;if(!o)return!1;if(t(o)){l(e,{role:o.role,color:e.movable.color},o.key)&&(i(e.movable.events.afterNewPiece,o.role,o.key,{predrop:!0}),n=!0)}return c(e),n},o.cancelMove=m,o.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,m(e)},o.getKeyAtDomPos=function(e,t,o){let r=Math.ceil((e[0]-o.left)/o.width*8);t||(r=9-r);let i=Math.ceil(8-(e[1]-o.top)/o.height*8);return t||(i=9-i),r>0&&r<9&&i>0&&i<9?n.pos2key([r,i]):void 0},o.whitePov=function(e){return"white"===e.orientation}},{"./premove":12,"./util":18}],4:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.configure=void 0;const n=e("./board"),r=e("./fen");function i(e){return"object"==typeof e}o.configure=function(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),function e(t,o){for(const n in o)i(t[n])&&i(o[n])?e(t[n],o[n]):t[n]=o[n]}(e,t),t.fen&&(e.pieces=r.read(t.fen),e.drawable.shapes=[]),t.hasOwnProperty("check")&&n.setCheck(e,t.check||!1),t.hasOwnProperty("lastMove")&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&n.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?1:8,o="e"+t,n=e.movable.dests[o],r=e.pieces[o];if(!n||!r||"king"!==r.role)return;e.movable.dests[o]=n.filter(e=>!(e==="1"+t&&-1!==n.indexOf("3"+t)||e==="9"+t&&-1!==n.indexOf("7"+t)))}}},{"./board":3,"./fen":10}],5:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.cancel=o.end=o.move=o.dragNewPiece=o.pieceCloseTo=o.start=void 0;const n=e("./board"),r=e("./util"),i=e("./draw"),s=e("./anim");function c(e,t){const o=n.whitePov(e),i=e.dom.bounds(),s=Math.pow(i.width/9,2);for(const n in e.pieces){const e=u(n,o,i),c=[e.left+e.width/2,e.top+e.height/2];if(r.distanceSq(c,t)<=s)return!0}return!1}function a(e){requestAnimationFrame(()=>{const t=e.draggable.current;if(!t)return;e.animation.current&&e.animation.current.plan.anims[t.orig]&&(e.animation.current=void 0);const o=e.pieces[t.orig];if(o&&r.samePiece(o,t.piece)){if(!t.started&&r.distanceSq(t.epos,t.rel)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){const e=t.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),t.element=e}t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]];const o=r.posToTranslateAbs(e.dom.bounds())(t.origPos,n.whitePov(e));o[0]+=t.pos[0]+t.dec[0],o[1]+=t.pos[1]+t.dec[1],r.translateAbs(t.element,o)}}else l(e);a(e)})}function l(e){const t=e.draggable.current;t&&(t.newPiece&&delete e.pieces[t.orig],e.draggable.current=void 0,n.unselect(e),d(e),e.dom.redraw())}function d(e){const t=e.dom.elements;t.ghost&&r.setVisible(t.ghost,!1)}function u(e,t,o){const n=r.key2pos(e);return t||(n[0]=10-n[0],n[1]=10-n[1]),{left:o.left+o.width*(n[0]-1)/9,top:o.top+o.height*(9-n[1])/9,width:o.width/9,height:o.height/9}}function p(e,t){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===t&&"PIECE"===o.tagName)return o;o=o.nextSibling}}o.start=function(e,t){if(void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const o=e.dom.bounds(),l=r.eventPosition(t),d=n.getKeyAtDomPos(l,n.whitePov(e),o);if(!d)return;const f=e.pieces[d],g=e.selected;g||!e.drawable.enabled||!e.drawable.eraseOnClick&&f&&f.color===e.turnColor||i.clear(e),!1===t.cancelable||t.touches&&e.movable.color&&!f&&!g&&!c(e,l)||t.preventDefault();const v=!!e.premovable.current,h=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&n.canMove(e,e.selected,d)?s.anim(e=>n.selectSquare(e,d),e):n.selectSquare(e,d);const m=e.selected===d,b=p(e,d);if(f&&b&&m&&n.isDraggable(e,d)){const i=u(d,n.whitePov(e),o);e.draggable.current={orig:d,origPos:r.key2pos(d),piece:f,rel:l,epos:l,pos:[0,0],dec:e.draggable.centerPiece?[l[0]-(i.left+i.width/2),l[1]-(i.top+i.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:g,originTarget:t.target},b.cgDragging=!0,b.classList.add("dragging");const s=e.dom.elements.ghost;s&&(s.className=`ghost ${f.color} ${f.role}`,r.translateAbs(s,r.posToTranslateAbs(o)(r.key2pos(d),n.whitePov(e))),r.setVisible(s,!0)),a(e)}else v&&n.unsetPremove(e),h&&n.unsetPredrop(e);e.dom.redraw()},o.pieceCloseTo=c,o.dragNewPiece=function(e,t,o,i){e.pieces[11]=t,e.dom.redraw();const s=r.eventPosition(o),c=n.whitePov(e),l=e.dom.bounds(),d=u("11",c,l),f=[(c?0:8)*d.width+l.left,(c?9:-1)*d.height+l.top];e.draggable.current={orig:"11",origPos:r.key2pos("11"),piece:t,rel:f,epos:s,pos:[s[0]-f[0],s[1]-f[1]],dec:[-d.width/2,-d.height/2],started:!0,element:()=>p(e,"11"),originTarget:o.target,newPiece:!0,force:!!i},a(e)},o.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=r.eventPosition(t))},o.end=function(e,t){const o=e.draggable.current;if(!o)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&o&&o.originTarget!==t.target&&!o.newPiece)return void(e.draggable.current=void 0);n.unsetPremove(e),n.unsetPredrop(e);const i=r.eventPosition(t)||o.epos,s=n.getKeyAtDomPos(i,n.whitePov(e),e.dom.bounds());s&&o.started&&o.orig!==s?o.newPiece?n.dropNewPiece(e,o.orig,s,o.force):(e.stats.ctrlKey=t.ctrlKey,n.userMove(e,o.orig,s)&&(e.stats.dragged=!0)):o.newPiece?delete e.pieces[o.orig]:e.draggable.deleteOnDropOff&&!s&&(delete e.pieces[o.orig],n.callUserFunction(e.events.change)),(o.orig!==o.previouslySelected||o.orig!==s&&s)&&e.selectable.enabled||n.unselect(e),d(e),e.draggable.current=void 0,e.dom.redraw()},o.cancel=l},{"./anim":1,"./board":3,"./draw":6,"./util":18}],6:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.clear=o.cancel=o.end=o.move=o.processDraw=o.start=void 0;const n=e("./board"),r=e("./util"),i=["green","red","blue","yellow"];function s(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const o=n.getKeyAtDomPos(t.pos,n.whitePov(e),e.dom.bounds());o!==t.mouseSq&&(t.mouseSq=o,t.dest=o!==t.orig?o:void 0,e.dom.redrawNow()),s(e)}})}function c(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function a(e){const t=(e.shiftKey||e.ctrlKey)&&r.isRightButton(e),o=e.altKey||e.metaKey||e.getModifierState("AltGraph");return i[(t?1:0)+(o?2:0)]}function l(e){e.onChange&&e.onChange(e.shapes)}o.start=function(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?n.unselect(e):n.cancelMove(e);const o=r.eventPosition(t),i=n.getKeyAtDomPos(o,n.whitePov(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:o,brush:a(t)},s(e))},o.processDraw=s,o.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=r.eventPosition(t))},o.end=function(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const o=e=>e.orig===t.orig&&e.dest===t.dest,n=e.shapes.find(o);n&&(e.shapes=e.shapes.filter(e=>!o(e)));n&&n.brush===t.brush||e.shapes.push(t);l(e)}(e.drawable,t),c(e))},o.cancel=c,o.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),l(e.drawable))}},{"./board":3,"./util":18}],7:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.drop=o.cancelDropMode=o.setDropMode=void 0;const n=e("./board"),r=e("./util"),i=e("./drag");o.setDropMode=function(e,t){e.dropmode={active:!0,piece:t},i.cancel(e)},o.cancelDropMode=function(e){e.dropmode={active:!1}},o.drop=function(e,t){if(!e.dropmode.active)return;n.unsetPremove(e),n.unsetPredrop(e);const o=e.dropmode.piece;if(o){e.pieces.a0=o;const i=r.eventPosition(t),s=i&&n.getKeyAtDomPos(i,n.whitePov(e),e.dom.bounds());s&&n.dropNewPiece(e,"11",s)}e.dom.redraw()}},{"./board":3,"./drag":5,"./util":18}],8:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.bindDocument=o.bindBoard=void 0;const n=e("./drag"),r=e("./draw"),i=e("./drop"),s=e("./util");function c(e,t,o,n){return e.addEventListener(t,o,n),()=>e.removeEventListener(t,o)}function a(e,t,o){return n=>{n.shiftKey||s.isRightButton(n)?e.drawable.enabled&&o(e,n):e.viewOnly||t(e,n)}}o.bindBoard=function(e){if(e.viewOnly)return;const t=e.dom.elements.board,o=function(e){return t=>{e.draggable.current?n.cancel(e):e.drawable.current?r.cancel(e):t.shiftKey||s.isRightButton(t)?e.drawable.enabled&&r.start(e,t):e.viewOnly||(e.dropmode.active?i.drop(e,t):n.start(e,t))}}(e);t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("mousedown",o,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",e=>e.preventDefault())},o.bindDocument=function(e,t){const o=[];if(!e.dom.relative&&e.resizable){const n=()=>{e.dom.bounds.clear(),requestAnimationFrame(t)};o.push(c(document.body,"shogiground.resize",n))}if(!e.viewOnly){const t=a(e,n.move,r.move),i=a(e,n.end,r.end);for(const e of["touchmove","mousemove"])o.push(c(document,e,t));for(const e of["touchend","mouseup"])o.push(c(document,e,i));const s=()=>e.dom.bounds.clear();o.push(c(window,"scroll",s,{passive:!0})),o.push(c(window,"resize",s,{passive:!0}))}return()=>o.forEach(e=>e())}},{"./drag":5,"./draw":6,"./drop":7,"./util":18}],9:[function(e,t,o){"use strict";function n(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{n(e,2),setTimeout(()=>n(e,void 0),120)},120)}},{}],10:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.write=o.read=o.initial=void 0;const n=e("./util"),r=e("./types");o.initial="lnsgkgsnl/1b5r1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL";const i={p:"pawn",r:"rook",n:"knight",b:"bishop",g:"gold",l:"lance",s:"silver",k:"king"},s={pawn:"p",lance:"l",rook:"r",knight:"n",bishop:"b",gold:"g",silver:"s",king:"k"};o.read=function(e){"start"===e&&(e=o.initial);const t={};let r=9,s=0;for(const o of e)switch(o){case" ":return t;case"/":if(--r,0===r)return t;s=0;break;case"~":const e=t[n.pos2key([s,r])];e&&(e.promoted=!0);break;default:const c=o.charCodeAt(0);if(c<57)s+=c-48;else{++s;const e=o.toLowerCase();t[n.pos2key([s,r])]={role:i[e],color:o===e?"black":"white"}}}return t},o.write=function(e){return n.invRanks.map(t=>r.ranks.map(o=>{const r=e[n.pos2key([o,t])];if(r){const e=s[r.role];return"white"===r.color?e.toUpperCase():e}return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}},{"./types":17,"./util":18}],11:[function(e,t,o){t.exports=e("./shogiground").Shogiground},{"./shogiground":14}],12:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const n=e("./util");function r(e,t){return Math.abs(e-t)}const i=(e,t,o,n)=>r(e,o)===r(t,n),s=(e,t,o,n)=>e===o||t===n;const c=(e,t,o,n)=>r(e,o)<2&&r(t,n)<2,a=n.allKeys.map(n.key2pos);o.default=function(e,t){const o=e[t],l=n.key2pos(t),d=o.role,u="pawn"===d?(p=o.color,(e,t,o,n)=>"white"===p?e===o&&n==t+1:e===o&&n==t-1):"knight"===d?function(e){return(t,o,n,i)=>{const s=r(t,n);return"white"===e?1===s&&i==o+2:1===s&&i==o-2}}(o.color):"bishop"===d?i:"rook"===d?s:"lance"===d?function(e){return(t,o,n,r)=>t===n&&("white"===e?r>o:o>r)}(o.color):"silver"===d?function(e){return(t,o,n,i)=>{const s=r(t,n),c=r(o,i);return 1===s&&1==c||("white"===e?t===n&&i==o+1:t===n&&i==o-1)}}(o.color):"gold"===d?function(e){return(t,o,n,i)=>{const s=r(t,n);return"white"===e?s<2&&i===o+1||t===n&&i===o-1||o===i&&1===s:s<2&&i===o-1||t===n&&i===o+1||o===i&&1===s}}(o.color):c;var p;return a.filter(e=>(l[0]!==e[0]||l[1]!==e[1])&&u(l[0],l[1],e[0],e[1])).map(n.pos2key)}},{"./util":18}],13:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const n=e("./util"),r=e("./board"),i=e("./util");function s(e){return"PIECE"===e.tagName}function c(e){return"SQUARE"===e.tagName}function a(e,t){for(const o in t)e.dom.elements.board.removeChild(t[o])}function l(e,t){let o=2+8*(e[1]-1)+(8-e[0]);return t&&(o=67-o),o+""}function d(e){return`${e.color} ${e.role}`}function u(e,t,o){e[t]?e[t]+=" "+o:e[t]=o}o.default=function(e){const t=r.whitePov(e),o=e.dom.relative?i.posToTranslateRel:i.posToTranslateAbs(e.dom.bounds()),p=e.dom.relative?i.translateRel:i.translateAbs,f=e.dom.elements.board,g=e.pieces,v=e.animation.current,h=v?v.plan.anims:{},m=v?v.plan.fadings:{},b=e.draggable.current,y=function(e){const t={};let o,n;if(e.lastMove&&e.highlight.lastMove)for(o in e.lastMove)u(t,e.lastMove[o],"last-move");e.check&&e.highlight.check&&u(t,e.check,"check");if(e.selected&&(u(t,e.selected,"selected"),e.movable.showDests)){const r=e.movable.dests&&e.movable.dests[e.selected];if(r)for(o in r)n=r[o],u(t,n,"move-dest"+(e.pieces[n]?" oc":""));const i=e.premovable.dests;if(i)for(o in i)n=i[o],u(t,n,"premove-dest"+(e.pieces[n]?" oc":""))}const r=e.premovable.current;if(r)for(o in r)u(t,r[o],"current-premove");else e.predroppable.current&&u(t,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(o in i.keys)u(t,i.keys[o],"exploding"+i.stage);return t}(e),w={},P={},k={},M={},C=Object.keys(g);let S,O,x,A,K,D,_,N,T,E,j;for(x=f.firstChild;x;){if(S=x.cgKey,s(x))if(A=g[S],D=h[S],_=m[S],K=x.cgPiece,!x.cgDragging||b&&b.orig===S||(x.classList.remove("dragging"),p(x,o(n.key2pos(S),t)),x.cgDragging=!1),!_&&x.cgFading&&(x.cgFading=!1,x.classList.remove("fading")),A){if(D&&x.cgAnimating&&K===d(A)){const e=n.key2pos(S);e[0]+=D[2],e[1]+=D[3],x.classList.add("anim"),p(x,o(e,t))}else x.cgAnimating&&(x.cgAnimating=!1,x.classList.remove("anim"),p(x,o(n.key2pos(S),t)),e.addPieceZIndex&&(x.style.zIndex=l(n.key2pos(S),t)));K!==d(A)||_&&x.cgFading?_&&K===d(_)?(x.classList.add("fading"),x.cgFading=!0):k[K]?k[K].push(x):k[K]=[x]:w[S]=!0}else k[K]?k[K].push(x):k[K]=[x];else if(c(x)){const e=x.className;y[S]===e?P[S]=!0:M[e]?M[e].push(x):M[e]=[x]}x=x.nextSibling}for(const r in y)if(!P[r]){E=M[y[r]],j=E&&E.pop();const e=o(n.key2pos(r),t);if(j)j.cgKey=r,p(j,e);else{const t=n.createEl("square",y[r]);t.cgKey=r,p(t,e),f.insertBefore(t,f.firstChild)}}for(const r in C)if(S=C[r],O=g[S],D=h[S],!w[S])if(N=k[d(O)],T=N&&N.pop(),T){T.cgKey=S,T.cgFading&&(T.classList.remove("fading"),T.cgFading=!1);const r=n.key2pos(S);e.addPieceZIndex&&(T.style.zIndex=l(r,t)),D&&(T.cgAnimating=!0,T.classList.add("anim"),r[0]+=D[2],r[1]+=D[3]),p(T,o(r,t))}else{const r=d(O),i=n.createEl("piece",r),s=n.key2pos(S);i.cgPiece=r,i.cgKey=S,D&&(i.cgAnimating=!0,s[0]+=D[2],s[1]+=D[3]),p(i,o(s,t)),e.addPieceZIndex&&(i.style.zIndex=l(s,t)),f.appendChild(i)}for(const n in k)a(e,k[n]);for(const n in M)a(e,M[n])}},{"./board":3,"./util":18}],14:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Shogiground=void 0;const n=e("./api"),r=e("./config"),i=e("./state"),s=e("./wrap"),c=e("./events"),a=e("./render"),l=e("./svg"),d=e("./util");function u(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}o.Shogiground=function(e,t){const o=i.defaults();function p(){const t=o.dom&&o.dom.unbind,n=o.viewOnly&&!o.drawable.visible,r=s.default(e,o,n),i=d.memo(()=>r.board.getBoundingClientRect()),f=e=>{a.default(o),!e&&r.svg&&l.renderSvg(o,r.svg)};o.dom={elements:r,bounds:i,redraw:u(f),redrawNow:f,unbind:t,relative:n},o.drawable.prevSvgHash="",f(!1),c.bindBoard(o),t||(o.dom.unbind=c.bindDocument(o,p)),o.events.insert&&o.events.insert(r)}return r.configure(o,t||{}),p(),n.start(o,p)}},{"./api":2,"./config":4,"./events":8,"./render":13,"./state":15,"./svg":16,"./util":18,"./wrap":19}],15:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.defaults=void 0;const n=e("./fen"),r=e("./util");o.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!1,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!1},premovable:{enabled:!0,showDests:!0,castle:!1,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"/static/pieces/"},prevSvgHash:""},hold:r.timer()}}},{"./fen":10,"./util":18}],16:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.renderSvg=o.createElement=void 0;const n=e("./util");function r(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function i({orig:e,dest:t,brush:o,piece:n,modifiers:r},i,c){return[c,e,t,o,t&&i[t]>1,n&&s(n),r&&(a=r,""+(a.lineWidth||""))].filter(e=>e).join("");var a}function s(e){return[e.color,e.role,e.scale].filter(e=>e).join("")}function c(e,{shape:t,current:o,hash:i},s,c,a){let v;if(t.piece)v=function(e,t,o,n){const i=g(t,n),s=n.width/8*(o.scale||1),c=o.color[0]+("knight"===o.role?"n":o.role[0]).toUpperCase();return l(r("image"),{className:`${o.role} ${o.color}`,x:i[0]-s/2,y:i[1]-s/2,width:s,height:s,href:e+c+".svg"})}(e.drawable.pieces.baseUrl,d(n.key2pos(t.orig),e.orientation),t.piece,a);else{const i=d(n.key2pos(t.orig),e.orientation);if(t.dest){let h=s[t.brush];t.modifiers&&(h=u(h,t.modifiers)),v=function(e,t,o,n,i,s){const c=function(e,t){return(t?20:10)/512*e.width}(s,i&&!n),a=g(t,s),d=g(o,s),u=d[0]-a[0],v=d[1]-a[1],h=Math.atan2(v,u),m=Math.cos(h)*c,b=Math.sin(h)*c;return l(r("line"),{stroke:e.color,"stroke-width":p(e,n,s),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:f(e,n),x1:a[0],y1:a[1],x2:d[0]-m,y2:d[1]-b})}(h,i,d(n.key2pos(t.dest),e.orientation),o,c[t.dest]>1,a)}else v=function(e,t,o,n){const i=g(t,n),s=function(e){const t=e.width/512;return[3*t,4*t]}(n),c=(n.width+n.height)/32;return l(r("circle"),{stroke:e.color,"stroke-width":s[o?0:1],fill:"none",opacity:f(e,o),cx:i[0],cy:i[1],r:c-s[1]/2})}(s[t.brush],i,o,a)}return v.setAttribute("cgHash",i),v}function a(e){const t=l(r("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(l(r("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function l(e,t){for(const o in t)e.setAttribute(o,t[o]);return e}function d(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function u(e,t){const o={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return o.key=[e.key,t.lineWidth].filter(e=>e).join(""),o}function p(e,t,o){return(e.lineWidth||10)*(t?.85:1)/512*o.width}function f(e,t){return(e.opacity||1)*(t?.9:1)}function g(e,t){return[(e[0]-.5)*t.width/8,(8.5-e[1])*t.height/8]}o.createElement=r,o.renderSvg=function(e,t){const o=e.drawable,n=o.current,r=n&&n.mouseSq?n:void 0,s={};for(const i of o.shapes.concat(o.autoShapes).concat(r?[r]:[]))i.dest&&(s[i.dest]=(s[i.dest]||0)+1);const l=o.shapes.concat(o.autoShapes).map(e=>({shape:e,current:!1,hash:i(e,s,!1)}));r&&l.push({shape:r,current:!0,hash:i(r,s,!0)});const d=l.map(e=>e.hash).join("");if(d===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=d;const p=t.firstChild;!function(e,t,o){const n={};let r;for(const c of t)c.shape.dest&&(r=e.brushes[c.shape.brush],c.shape.modifiers&&(r=u(r,c.shape.modifiers)),n[r.key]=r);const i={};let s=o.firstChild;for(;s;)i[s.getAttribute("cgKey")]=!0,s=s.nextSibling;for(const c in n)i[c]||o.appendChild(a(n[c]))}(o,l,p),function(e,t,o,n,r,i){const s=e.dom.bounds(),a={},l=[];for(const c of t)a[c.hash]=!1;let d,u=i.nextSibling;for(;u;)d=u.getAttribute("cgHash"),a.hasOwnProperty(d)?a[d]=!0:l.push(u),u=u.nextSibling;for(const c of l)r.removeChild(c);for(const p of t)a[p.hash]||r.appendChild(c(e,p,o,n,s))}(e,l,o.brushes,s,t,p)}},{"./util":18}],17:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ranks=o.files=void 0,o.files=[1,2,3,4,5,6,7,8,9],o.ranks=[1,2,3,4,5,6,7,8,9]},{}],18:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.createEl=o.isRightButton=o.eventPosition=o.setVisible=o.translateRel=o.translateAbs=o.posToTranslateRel=o.posToTranslateAbs=o.samePiece=o.distanceSq=o.containsX=o.opposite=o.timer=o.memo=o.key2pos=o.pos2key=o.allKeys=o.invRanks=o.colors=void 0;const n=e("./types");o.colors=["white","black"],o.invRanks=[9,8,7,6,5,4,3,2,1],o.allKeys=Array.prototype.concat(...n.files.map(e=>n.ranks.map(t=>e+t))),o.pos2key=e=>o.allKeys[9*e[0]+e[1]-10],o.key2pos=e=>[parseInt(e[0]),parseInt(e[1])],o.memo=function(e){let t;const o=()=>(void 0===t&&(t=e()),t);return o.clear=()=>{t=void 0},o},o.timer=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},o.opposite=e=>"white"===e?"black":"white",o.containsX=function(e,t){return void 0!==e&&-1!==e.indexOf(t)},o.distanceSq=(e,t)=>Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2),o.samePiece=(e,t)=>e.role===t.role&&e.color===t.color;const r=(e,t,o,n)=>[(t?e[0]-1:9-e[0])*o,(t?9-e[1]:e[1]-1)*n];o.posToTranslateAbs=e=>{const t=e.width/9,o=e.height/9;return(e,n)=>r(e,n,t,o)},o.posToTranslateRel=(e,t)=>r(e,t,100,100),o.translateAbs=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},o.translateRel=(e,t)=>{e.style.transform=`translate(${t[0]}%,${t[1]}%)`},o.setVisible=(e,t)=>{e.style.visibility=t?"visible":"hidden"},o.eventPosition=e=>e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0,o.isRightButton=e=>2===e.buttons||2===e.button,o.createEl=(e,t)=>{const o=document.createElement(e);return t&&(o.className=t),o}},{"./types":17}],19:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const n=e("./util"),r=e("./types"),i=e("./svg");function s(e,t){const o=n.createEl("coords",t);let r;for(const i of e)r=n.createEl("coord"),r.textContent=i,o.appendChild(r);return o}o.default=function(e,t,o){e.innerHTML="",e.classList.add("cg-wrap");for(const r of n.colors)e.classList.toggle("orientation-"+r,t.orientation===r);e.classList.toggle("manipulable",!t.viewOnly);const c=n.createEl("cg-helper");e.appendChild(c);const a=n.createEl("cg-container");c.appendChild(a);const l=n.createEl("cg-board");let d,u;if(a.appendChild(l),t.drawable.visible&&!o&&(d=i.createElement("svg"),d.appendChild(i.createElement("defs")),a.appendChild(d)),t.coordinates){const e="black"===t.orientation?" black":"";a.appendChild(s(r.ranks.map(e=>e.toString()),"ranks"+e)),a.appendChild(s(r.files.map(e=>e.toString()),"files"+e))}return t.draggable.showGhost&&!o&&(u=n.createEl("piece","ghost"),n.setVisible(u,!1),a.appendChild(u)),{board:l,container:a,ghost:u,svg:d}}},{"./svg":16,"./types":17,"./util":18}]},{},[11])(11)}));